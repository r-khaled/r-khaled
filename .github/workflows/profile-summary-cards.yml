name: GitHub Profile Summary Cards

on:
  workflow_dispatch:

permissions:
  contents: write

jobs:
  summary-cards:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Verify GH_TOKEN works (GitHub API)
        env:
          GH_TOKEN: ${{ secrets.GH_TOKEN }}
        run: |
          if [ -z "$GH_TOKEN" ]; then
            echo "❌ GH_TOKEN secret is EMPTY / not visible to workflow"
            exit 1
          fi

          echo "✅ GH_TOKEN exists (length: ${#GH_TOKEN})"
          echo "Testing GitHub API auth..."
          curl -s -o /tmp/resp.json -w "%{http_code}" \
            -H "Authorization: Bearer $GH_TOKEN" \
            -H "Accept: application/vnd.github+json" \
            https://api.github.com/user > /tmp/code.txt

          CODE=$(cat /tmp/code.txt)
          echo "HTTP CODE: $CODE"

          if [ "$CODE" != "200" ]; then
            echo "❌ Token is not authorized. Response:"
            cat /tmp/resp.json
            exit 1
          fi

          echo "✅ Token authorized successfully."

      - name: Generate summary cards
        uses: vn7n24fzkq/github-profile-summary-cards@release
        with:
          USERNAME: YOUR_USERNAME_HERE
          BRANCH_NAME: main
          THEME: github_dark
          GITHUB_TOKEN: ${{ secrets.GH_TOKEN }}
